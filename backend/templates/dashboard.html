{% extends "base.html" %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h2 class="mb-0">Dashboard</h2>
  <a class="btn btn-sm btn-outline-primary" href="/rules">Manage Rules</a>
</div>

<div class="card mb-4">
  <div class="card-header d-flex justify-content-between align-items-center">
    <span>Run Labeler</span>
    <div>
      <button class="btn btn-sm btn-outline-primary" id="init-default-labels-btn">
        Init Default @LL Labels
      </button>
      <button class="btn btn-sm btn-primary" id="run-labeler-btn">
        Run Now
      </button>
    </div>
  </div>
  <div class="card-body">
    <div id="init-labels-status" class="mb-2 small text-muted"></div>
    <div id="run-labeler-status" class="small text-muted"></div>
    <div class="mt-2">
      <a id="download-run-log-link" href="/download-run-log" class="small" target="_blank" rel="noopener">
        Download last run log
      </a>
    </div>
  </div>
</div>

<div class="card mb-4">
  <div class="card-header d-flex justify-content-between align-items-center">
    <button
      class="btn btn-sm btn-outline-secondary"
      type="button"
      data-bs-toggle="collapse"
      data-bs-target="#labelsCollapse"
      aria-expanded="true"
      aria-controls="labelsCollapse"
      id="toggle-labels-btn"
    >
      Collapse
    </button>

    <span class="ms-2 flex-grow-1">Labels &amp; Unread Counts</span>

    <button class="btn btn-sm btn-outline-secondary" id="refresh-labels-btn">
      Refresh Labels
    </button>
  </div>

  <div id="labelsCollapse" class="collapse show">
    <div class="card-body">
      <div class="table-responsive">
        <table class="table table-sm table-striped align-middle">
          <thead>
            <tr>
              <th>Label</th>
              <th class="text-end">Unread</th>
              <th class="text-end">Total</th>
              <th class="text-end">Actions</th>
            </tr>
          </thead>
          <tbody id="labels-table-body">
            <tr><td colspan="4" class="text-muted">Loadingâ€¦</td></tr>
          </tbody>
        </table>
      </div>
      <div id="labels-status" class="small text-muted"></div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='dashboard.js') }}"></script>
{% endblock %}
